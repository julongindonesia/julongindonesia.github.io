<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聚龙健康100指数</title>
    <script src="https://cdn.staticfile.net/jquery/1.10.2/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .section-header {
            background-color: #e6e6e6;
            font-weight: bold;
        }
        .total-row {
            font-weight: bold;
        }
        #periodSelect, #languageSelect {
            width: 200px;
            height: 30px;
            font-family: Arial, sans-serif;
            color: #333;
            border: 1px solid #ccc;
        }


        /* 添加响应式设计 */
      @media screen and (max-width: 600px) {
        table, tbody tr,tbody td{
            display: block;
        }
        
        tbody th {
            display: none;
        }

        /* 保持表头的原有布局 */
        /* thead {
            display: none; 
        } */

        /* 数据行样式 */
        tbody tr {
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }

        tbody td {
            border: none;
            position: relative;
            padding-left: 50%;
            text-align: left;
        }

        tbody td:before {
            content: attr(data-label);
            position: absolute;
            left: 6px;
            width: 45%;
            padding-right: 10px;
            white-space: nowrap;
            font-weight: bold;
        }
        
        /* 调整字体大小 */
        body {
            font-size: 14px;
        }

        /* 确保宽度不超过屏幕 */
        /* table {
            width: 100%;
        } */
      }
    </style>
</head>
<body>
  <h2 style="text-align: center;">聚龙健康100指数</h2>
  <h3 style="text-align: center;">100 Indikator sehat Julong </h3>
  <p id="tanggal" style="text-align: center;">草稿5（更新日期：2024.07.08）</p> 

  <p style="text-align: center;">
    <label>Language:</label>
    <select id="languageSelect">
      <option value="china">中文</option>
      <option value="indonesia">Indonesia</option>
      <option value="double">双语</option>
    </select>
    <br>
    <label>Period:</label>
    <select id="periodSelect">
      <option value="week1">week1</option>
      <option value="week2">week2</option>
      <option value="week3">week3</option>
      <option value="week4">week4</option>
      <option value="month">month</option>
    </select>
  </p>

  <br>
  
  <table id="standard">
    <thead id="total">
        <tr class="section-header">
          <td colspan="4"><h3>聚龙健康100指数</h3></td>
          <td colspan="5">总分数：100</td>
        </tr>
    </thead>
    <!-- human -->
    <thead id = "human_resource">
      <tr class="section-header">
        <td colspan="4">一 人</td>
        <td colspan="3">杨义</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='human_resource' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- finance -->
    <thead id = "finance">
      <tr class="section-header">
        <td colspan="4">二 财</td>
        <td colspan="3">侯光珍</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='finance' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- material -->
    <thead id = "material">
      <tr class="section-header">
        <td colspan="4">三 物</td>
        <td colspan="3">孙忠宝</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='material' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- agriculture -->
    <thead id = "agriculture">
      <tr class="section-header">
        <td colspan="4">四 农</td>
        <td colspan="3">皮金鹏</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='agriculture' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- industry -->
    <thead id = "industry">
      <tr class="section-header">
        <td colspan="4">五 工</td>
        <td colspan="3">王涛</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='industry' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- commerce -->
    <thead id = "commerce">
      <tr class="section-header">
        <td colspan="4">六 商</td>
        <td colspan="3">徐传贵</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='commerce' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- big data -->
    <thead id = "big_data">
      <tr class="section-header">
        <td colspan="4">七 4G大数据</td>
        <td colspan="3">杨江树</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='big_data' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- internet -->
    <thead id = "internet">
      <tr class="section-header">
        <td colspan="4">八 5G互联网</td>
        <td colspan="3">胡军</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='internet' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- ai -->
    <thead id = "ai">
      <tr class="section-header">
        <td colspan="4">九 人工智能</td>
        <td colspan="3">雷文忠</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='ai' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>
    <!-- legal -->
    <thead id = "legal">
      <tr class="section-header">
        <td colspan="4">十 法律</td>
        <td colspan="3">杨斌</td>
        <td colspan="2">3</td>
      </tr>
    </thead>
    <tbody id='legal' class="inactive" style="display: none;">
      <tr>
        <th colspan="1">序号</th>
        <th colspan="3">分项</th>
        <th colspan="1">负责人</th>
        <th colspan="1">前值</th>
        <th colspan="1">预测值</th>
        <th colspan="1">实际值</th>
        <th colspan="1">分数</th>
      </tr>
    </tbody>

  </table>

  <script>
    // 默认值
    file_path = 'score_result.json' // 主要数据的存储文件
    title_path = 'title.json' // 标题国际化的存储文件
    period = 'week1' // 时间段
    language = 'china' // 语言
    // 大指标的关键字
    stand_list = ['human_resource','finance','material','agriculture','industry',
      'commerce', 'big_data','internet','ai','legal'
    ]
    // 计算得分的数据结构
    section_score= {
      'human_resource':0,
      'finance':0,
      'material':0,
      'agriculture':0,
      'industry':0,
      'commerce':0, 
      'big_data':0,
      'internet':0,
      'ai':0,
      'legal':0
    }
    // 每个时间段对应的日期
    tanggal = {
      "week1" : "2024.06.29 - 2024.07.05",
      "week2" : "2024.07.06 - 2024.07.12",
      "week3" : "2024.07.13 - 2024.07.19",
      "week4" : "2024.07.20 - 2024.07.26",
      "month" : "2024.07.01 - 2024.07.30"
    }

    // 函数：大标题缩放功能
    cs = function(section){
      $('thead#'+section).click(function(){
        var tbody = $('tbody#'+section)
        var singal = tbody.attr('class')
        if(singal == 'active'){
          tbody.attr('style','display:none')
          tbody.attr('class','inactive')
        }else{
          tbody.attr('style','')
          tbody.attr('class','active')
        }
      })
      // 注释缩放功能
      $('tbody#'+section).on('click', '[id^="data_"]', function(){
        var index = this.id.split('_')[1];
        tr_commen = $(`tr#commen_${index}_${section}`)
        var singal = tr_commen.attr('class')
        if(singal == 'active'){
          tr_commen.attr('style','display:none;')
          tr_commen.attr('class','inactive')
        }else{
          tr_commen.attr('style','')
          tr_commen.attr('class','active')
        }
      })
    }

    // 函数：具体指标数据的填写
    input_data = function(section, data_list){
      var section_score = 0
      var tbody = $('tbody#'+section)
      for(var index in data_list){
        var data = data_list[index]
        var add_tr = 
        `<tr id="data_${index}_${section}">
          <td data-label="序号">${data[0]}</td>
          <td data-label="分项" colspan="3">${data[1]}</td>
          <td data-label="负责人">${data[2]}</td>
          <td data-label="前值">${data[3]}</td>
          <td data-label="预测值">${data[4]}</td>
          <td data-label="实际值">${data[5]}</td>
          <td data-label="分数">${data[6]}</td>
        </tr>
        <tr id="commen_${index}_${section}" class="inactive" style="display: none;">
          <th colspan="9">分析: ${data[7]}</th>
        </tr>
        `
        tbody.append(add_tr)
        section_score = section_score + data[6]
      }
      return section_score
    }

    update_data = function(section, data_list, language){
      var section_score = 0
      for(var index in data_list){
        data = data_list[index]
        tr_data = $(`tr#data_${index}_${section}`)
        tr_commen = $(`tr#commen_${index}_${section}`)
        for(var i=1; i<=7; i++){
          tr_child = tr_data.children(`th:nth-child(${i})`)
          tr_child.text(data[i-1])
        }
        if(language == 'china'){
          tr_commen.children('th:nth-child(1)').text("分析:" + data[7])
        }else{
          tr_commen.children('th:nth-child(1)').text("Analisa:" + data[7])
        }
        
        section_score = section_score + data[6]
      }
      return section_score
    }
     
    // 将总得分写入指定位置
     input_total_score = function(section_score){
      var total = 0
      for(var key in section_score){
        td_key = $('thead#'+key).find('tr:first').children('td:nth-child(3)')
        td_key.text(section_score[key])
        total = total + section_score[key]
      }
      total_score = 'Total:' + total
      $('thead#total').children('tr:nth-child(1)').children('td:nth-child(2)').text(total_score)
    }

    // 渲染标题
    function get_title_data(title_path,language,section_list){
      // 获取数据
      var request = new XMLHttpRequest();
        request.open('get', title_path)
        request.send(null)
        request.onload = function(){
          var data = JSON.parse(request.responseText)
          data = data[language]
          $('thead#total').children('tr:nth-child(1)').children('td:nth-child(1)').find('h3:first').text(data['title'])

          section_title = data["section"]
          for(index in section_list){
            section = section_list[index]
            title = section_title[section]
            tr = $('thead#'+section).find("tr:first")
            tr.children("td:nth-child(1)").text(title["title"])
            tr.children("td:nth-child(2)").text(title["PIC"])
          }
          
          sub_title = data["sub_title"]
          tbody_tr = $('tbody').find('tr:first')
          for(var i=1; i<=7; i++){
            tbody_tr.children(`th:nth-child(${i})`).text(sub_title[i-1])
          }
      }
    }

    // 函数：渲染数据
    function input_period_data(path,period,language) {
        // 获取数据
      var score = 0
      var request = new XMLHttpRequest()
      request.open('get', path)
      request.send(null)
      request.onload = function(){
        var data = JSON.parse(request.responseText)
        data = data[period][language]
        // 渲染数据
        for(index in stand_list){
          section = stand_list[index]
          section_score[section] = 0  //将分数置为零，防止累加之前计算的得分
          section_score[section] = input_data(section,data[section])
        }
        // 渲染总分数
        input_total_score(section_score)
      }
    }

    // 只更新数据部分的数据
    function update_period_data(path, period, language) {
        // 获取数据
      var request = new XMLHttpRequest();
      request.open('get', path)
      request.send(null)
      request.onload = function(){
        var data = JSON.parse(request.responseText)
        data = data[period][language]
        // 渲染数据
        for(index in stand_list){
          section = stand_list[index]
          section_score[section] = 0  //将分数置为零，防止累加之前计算的得分
          section_score[section] = update_data(section,data[section],language)
        }
        // 渲染总分数
        input_total_score(section_score)
      }
    }

    // 网页开始时，要处理的事情
    input_period_data(file_path,period,language)
    get_title_data(title_path, language, stand_list)
    $("p#tanggal").text(tanggal[period])

    // 缩放
    for(index in stand_list){
      cs(stand_list[index])
    }

    $("#periodSelect").change(function(){
      // 根据下拉列表，获取当前时间段
      period = $("#periodSelect").val()
      language = $('#languageSelect').val()
      // 按照时间段更新数据，只重新渲染数据
      update_period_data(file_path,period,language)
      // 显示出所选时间段的具体时间
      $("p#tanggal").text(tanggal[period])
    })

    $("#languageSelect").change(function(){
      // 根据下拉列表，获取当前时间段
      language = $('#languageSelect').val()
      period = $("#periodSelect").val()
      // 按照选择的语言更新数据，只重新渲染数据
      update_period_data(file_path,period,language)
      get_title_data(title_path, language, stand_list)
    })

  </script>
</body>
</html>